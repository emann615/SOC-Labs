# EventID 36 - SOC104 - Malware Detected

## Alert

The Monitoring page shows that this alert was triggered because malware was detected. I took ownership of the alert, created a case, and started the playbook.

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/c7f6292d-6095-474b-85ca-c811c04a04f4" height="80%" width="80%"/>
</br>
</br>

## Define Threat Indicator

On the Log Management page, I searched the source address 10.15.15.18. The results show one entry that was created 7 min after the alert was triggered. The destination IP address on the entry is 92.63.8.47.

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/aa63dcf4-631e-46d6-9248-85e5b7d4ac87" height="80%" width="80%"/>
</br>
</br>


<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/9d850947-fa58-408c-a3d8-3293e63986e1" height="50%" width="50%"/>
</br>
</br>


I went to the Endpoint Security page and searched the source IP address (10.15.15.18). It is associated with the AdamPRD machine on the internal network

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/116c7f0f-b271-4ee5-bb95-7597bb6ddf23" height="80%" width="80%"/>
</br>
</br>

The process, network, terminal, and browser history on the machine show "No Agent Installed".

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/c4fd6ca8-201a-4e95-9865-87fcab8cc62b" height="50%" width="50%"/>
</br>
</br>

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/ae5008fe-3592-4631-a7c8-62aa502a62c6" height="50%" width="50%"/>
</br>
</br>

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/42cf2e65-243e-425d-a98a-3715cfeb378f" height="50%" width="50%"/>
</br>
</br>

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/77645608-c815-4fa9-8af5-5634e681fc71" height="50%" width="50%"/>
</br>
</br>

Next, I searched the destination IP address (92.63.8.47) found in the log entry. No results were returned, indicating the address belongs to an external network.

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/3106fde5-6c2e-42a9-b8dc-c5c7cb7e8d56" height="80%" width="80%"/>
</br>
</br>

Based on this information, there is unknown outgoing internet traffic, and the endpoint security for AdamPRD appears to be disabled.

## Check if the malware is quarantined/cleaned

According to the alert, device action was allowed, so the malware has not been quarantined/cleaned.

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/da2194e7-b344-4821-9004-1457468ea4aa" height="50%" width="50%"/>
</br>
</br>

## Analyze Malware

I searched the MD5 hash (f83fb9ce6a83da58b20685c1d7e1e546) for the Invoice.exe file in the VirusTotal. The results show that 63/71 vendors flagged the file as malicious. It was also identified as Maze ransomware.

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/49dd9ee5-9eae-4dfc-993e-eb736e304697" height="80%" width="80%"/>
</br>
</br>

I searched the MD5 hash in Hybrid Analysis, and the file was identified as malicious with 100/100 Threat Score.

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/48f268e0-1bc8-4dc6-898f-7cf74e79429f" height="80%" width="80%"/>
</br>
</br>

I also analyzed the file with AnyRun, and malicious activity was detected. The file creates a process named e8a091a84dd2ea7ee429135ff48e9f48f7787637ccb79f6c3eb42f34588bc684.exe. 

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/3ff16ca9-2ba1-4bfd-a40d-4db5951312b8" height="80%" width="80%"/>
</br>
</br>

Maze ransomware is detected in the process, and it steals credentials and encrypts data. 

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/d3d76d9b-f63c-49e3-a937-f11b9f40585f" height="50%" width="50%"/>
</br>
</br>

Connections were also made to multiple IP addresses, including 92.63.8.47. This is the same IP address that appears in the logs.

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/afe9ea73-2bec-44d4-b682-fee8ef4fe898" height="80%" width="80%"/>
</br>
</br>

I analyzed the IP address with VirusTotal, and 13/90 vendors flagged it as malicious.

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/02fc766d-7b7c-495c-b849-2dfded7c0cec" height="80%" width="80%"/>
</br>
</br>

## Check If Someone Requested the C2

Back on the Log Management page, I searched the C2 address (92.63.8.47). The same log entry I saw earlier in my investigation was returned. Connection to the C2 address was made from 10.15.15.18 (AdamPRD).

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/82428f0e-c0ac-4d3c-a8d8-f9fe4cc7037e" height="80%" width="80%"/>
</br>
</br>

## Containment

On the end Endpoint Security page, I contained the AdamPRD machine to prevent the spread of the attack.

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/3f867b70-2ce1-4b23-aea1-0f98bb428cc1" height="40%" width="40%"/>
</br>
</br>

## Add Artifacts

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/02d51111-e5b5-4d1e-ba57-6c2a9d687ff3" height="60%" width="60%"/>
</br>
</br>

## Analyst Note

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/4c1d7dc9-01df-468e-b9b6-0659495f7d36" height="60%" width="60%"/>
</br>
</br>

## Results

<img src="https://github.com/emann615/LetsDefendAlerts/assets/117882385/a1629eb6-dd6e-416e-80f6-d9299f805c92" height="80%" width="80%"/>
</br>
</br>
